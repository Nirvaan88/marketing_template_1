<!DOCTYPE html>
<html>
<head>
  <title>Marketing Template Editor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #f4f4f4;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 { margin: 20px; }
    .controls {
      width: 100%;
      max-width: 1200px;
      margin-bottom: 30px;
      background: #fff;
      padding: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .template-box {
      width: 794px;
      height: 1123px;
      border: 2px dashed #aaa;
      background-color: transparent;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      position: relative;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      margin: 0 auto;
    }
    .draggable { position: absolute; cursor: move; }
    .thumbnail-slider { display: flex; gap: 10px; overflow-x: auto; margin-top: 10px; padding-bottom: 30px; }
    .thumbnail-slider img { width: 100px; height: 100px; object-fit: cover; border: 2px solid transparent; cursor: pointer; }
    .thumbnail-slider img:hover { border-color: #007bff; } 
   
   
    
#storeFooterName {
  position: absolute;
  bottom: 30px;
  left: 50%;
  transform: translateX(-57%);
  text-align: center;
  color: #000;
  white-space: nowrap;
  transition: bottom 0.2s ease, font-size 0.15s ease;
  display: flex;
  align-items: center;
  gap: 6px;
  justify-content: center;
  padding: 08px;
  box-sizing: border-box;
  width: 86%;            /* reserve most of footer width for content */
  pointer-events: none;  /* keeps it non-interactive */
}

.store-address {
  display: inline-block;
  color: #000;
  margin-left: 15px;
  font-weight: 700;
  font-size: 11px;       /* default starting size (px) */
  line-height: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  pointer-events: auto;
}

.separator {
  font-weight: 600;
  font-size: 16px;
  line-height: 0.75;
}

.contact-logo {
  display: inline-flex;
  width: 20px;
  height: 20px;
  align-items: center;
  justify-content: center;
  margin-right: 2px; 
}

.store-mobile {
  display: inline-block;
  font-weight: 600;
  font-size: 12px;
  margin-left:0px;
}

  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

</head>
<body>

<h1>Marketing Template Editor</h1>
<div class="controls">
  <div>
    <label>Upload Background Image:</label>
    <input type="file" id="bgUpload" accept="image/*">
  </div>
  <div>
    <label>Choose Background Color:</label>
    <input type="color" id="bgColor">
    <button onclick="applyColor()">Apply Color</button>
  </div>
  <div>
    <label>Upload Logo:</label>
    <input type="file" id="logoUpload" accept="image/*">
  </div>
  <div>
    <label>Combined Color:</label>
    <input type="color" id="combinedColor" value="#000000">
    <button type="button" onclick="applyCombinedColor()">Apply Combined Color</button>
  </div>
<div>
  <label for="stateFilter">Select State:</label>
  <select id="stateFilter">
    <option value="">-- All States --</option>
  </select>
  <button type="button" id="generateStateTemplates">Generate Templates</button>
</div>

<div>
  <label>Upload Stores Excel (.xlsx/.xls/.csv):</label>
  <input type="file" id="storesExcel" accept=".xlsx,.xls,.csv">
</div>

<div>
  <label>Footer Text & Logo Color:</label>
  <input type="color" id="footerTextColor" value="#9A6C0C">
  <button type="button" onclick="applyFooterColor()">Apply Footer Color</button>
</div>




  <div>
    <label>Contact Logo Color:</label>
    <input type="color" id="contactLogoColor" value="#000000">
    <label>Store Name Color:</label>
    <input type="color" id="storeNameColor" value="#000000">
    <button type="button" onclick="applyColors()">Apply Colors</button>
    <button onclick="downloadEachTemplateA4()">Download All Templates (Separate PDFs)</button>
  </div>
  <div>
    <label>Add Footer Text:</label>
    <input type="text" id="footerName" placeholder="Store Name">
    <label>WhatsApp Number:</label>
    <input type="text" id="footerWhatsApp" placeholder="WhatsApp Number">
    <button type="button" onclick="updateFooterInfo()">Update Footer Text & WhatsApp</button>
  </div>
  <div>
    <button onclick="downloadPNG()">Download PNG</button>
    <button onclick="downloadPDF()">Download (A4)</button>
    <button onclick="downloadTemplate('templateBox', 'png')">Download Template as PNG</button>
    <button onclick="downloadTemplate('templateBox', 'pdf')">Download Template as PDF</button>
  </div>
  <div style="margin: 20px 0; width:100%; max-width:1200px; background:#fff; padding:15px; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
    <label>Upload Custom Template:</label>
    <input type="file" id="templateUpload" accept="image/*">
  </div>
</div>

<div id="templateBox" class="template-box">
  <p id="storeFooterName">Default Store Name</p>
  <div id="storeFooter"></div>
</div>

<div id="templatesContainer" style="margin-top:10px;"></div>
<h2>Templates</h2>
<div class="thumbnail-slider" id="templateSlider"></div>
<h2>Products</h2>
<div class="thumbnail-slider" id="productSlider"></div>
<h2>Banners</h2>
<div class="thumbnail-slider" id="bannerSlider"></div>

<script>
const templateBox = document.getElementById("templateBox");
const templateSlider = document.getElementById("templateSlider");

function makeDraggable(el) {
  el.onmousedown = function(e) {
    e.preventDefault();
    let shiftX = e.clientX - el.getBoundingClientRect().left;
    let shiftY = e.clientY - el.getBoundingClientRect().top;
    function moveAt(pageX, pageY) {
      el.style.left = pageX - shiftX - templateBox.getBoundingClientRect().left + "px";
      el.style.top = pageY - shiftY - templateBox.getBoundingClientRect().top + "px";
    }
    function onMouseMove(e) { moveAt(e.pageX, e.pageY); }
    document.addEventListener("mousemove", onMouseMove);
    document.onmouseup = function() {
      document.removeEventListener("mousemove", onMouseMove);
      document.onmouseup = null;
    };
  };
  el.ondragstart = () => false;
}

document.getElementById("bgUpload").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if(file) {
    const reader = new FileReader();
    reader.onload = ev => { templateBox.style.backgroundImage = `url(${ev.target.result})`; };
    reader.readAsDataURL(file);
  }
});

function applyColor() {
  const color = document.getElementById("bgColor").value;
  templateBox.style.backgroundImage = "";
  templateBox.style.backgroundColor = color;
}

document.getElementById("logoUpload").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if(file) {
    const reader = new FileReader();
    reader.onload = ev => {
      const logo = document.createElement("img");
      logo.src = ev.target.result;
      logo.className = "draggable";
      logo.style.width = "150px"; logo.style.height = "auto";
      logo.style.top = "20px"; logo.style.left = "20px";
      templateBox.appendChild(logo);
      makeDraggable(logo);
    };
    reader.readAsDataURL(file);
  }
});

async function downloadPNG() {
  const canvas = await html2canvas(templateBox);
  const link = document.createElement("a");
  link.download = "template.png";
  link.href = canvas.toDataURL();
  link.click();
}

async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const canvas = await html2canvas(templateBox, { scale: 2 });
  const imgData = canvas.toDataURL("image/png");
  const pdf = new jsPDF("p", "pt", "a4");
  const pageWidth = pdf.internal.pageSize.getWidth();
  const pageHeight = pdf.internal.pageSize.getHeight();
  pdf.addImage(imgData, "PNG", 0, 0, pageWidth, pageHeight);
  pdf.save("template.pdf");
}

// ---------------- Footer & Color Functions ----------------
function updateFooterInfo() {
  const storeNameVal = document.getElementById("footerName").value.trim() || "Store Name";
  const whatsappVal = document.getElementById("footerWhatsApp").value.trim();
  const separator = `<span class="separator">|</span>`;
  const contactLogo = `<span class="contact-logo">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <circle id="contactCircle" cx="12" cy="12" r="12" fill="#9A6C0C"/>
          <path id="contactIcon" d="M6.62 10.79a15.053 15.053 0 006.59 6.59l2.2-2.2a1 1 0 011.11-.21c1.21.48 2.53.73 3.88.73a1 1 0 011 1v3.5a1 1 0 01-1 1C10.07 21 3 13.93 3 5a1 1 0 011-1h3.5a1 1 0 011 1c0 1.35.25 2.67.73 3.88.12.28.07.61-.21 1.11l-2.2 2.2z" fill="white"/>
      </svg>
    </span>`;
  let footerHTML = storeNameVal;
  if(whatsappVal) footerHTML += separator + contactLogo + whatsappVal;

  const footerEl = document.getElementById("storeFooterName");
  if(footerEl) {
    footerEl.innerHTML = footerHTML;
    footerEl.style.display = "flex";
    footerEl.style.alignItems = "center";
    footerEl.style.gap = "2px";
    footerEl.style.whiteSpace = "nowrap";
  }
  adjustFooterFontSize();
  adjustFooterPosition();
}
function applyColors() {
  const storeNameColor = document.getElementById("storeNameColor").value;
  const storeName = document.getElementById("storeFooterName");
  if(storeName) storeName.style.color = storeNameColor;

  const logoColor = document.getElementById("contactLogoColor").value;
  document.querySelectorAll('#contactCircle').forEach(c => c.setAttribute('fill', logoColor));
  document.querySelectorAll('#contactIcon').forEach(p => p.setAttribute('fill', '#fff'));

  // ðŸ‘‡ new line: make mobile number dark
  document.querySelectorAll('.store-mobile').forEach(m => m.style.color = '#000');
}

function applyFooterColor() {
  const footerColor = document.getElementById("footerTextColor").value;

  // ðŸ¢ store address & ðŸ“ž mobile number color
  document.querySelectorAll(".store-address, .store-mobile").forEach(el => {
    el.style.color = footerColor;
    el.style.fontWeight = "700";
  });

  // ðŸŸ¤ contact circle color
  document.querySelectorAll(".contact-circle").forEach(c => {
    c.setAttribute("fill", footerColor);
  });


    // | Separator color
  document.querySelectorAll(".separator").forEach(sep => {
    sep.style.color = footerColor;
    sep.style.fontWeight = "700";
  });

  // â˜Žï¸ phone icon stays white always
  document.querySelectorAll(".contact-icon").forEach(p => {
    p.setAttribute("fill", "#ffffff");
  });
 
}


function applyCombinedColor() {
  const color = document.getElementById("combinedColor").value;
  const storeName = document.getElementById("storeFooterName");
  if(storeName) storeName.style.color = color;
  document.querySelectorAll('#contactCircle').forEach(c => c.setAttribute('fill', color));
}
function adjustFooterFontSize() {
  const footers = document.querySelectorAll("#storeFooterName");
  footers.forEach(footer => {
    const addr = footer.querySelector(".store-address");
    if (!addr) return;

    // Always keep in one line
    addr.style.whiteSpace = "nowrap";
    addr.style.display = "inline-block";
    addr.style.overflow = "hidden";
    addr.style.textOverflow = "ellipsis";

    // Define font size range
    const maxFont = 14; // for short address
    const minFont = 8;  // for very long address
    let fontSize = maxFont;

    // Start at max font
    addr.style.fontSize = fontSize + "px";

    // Calculate available space in footer (minus icons, QR, etc.)
    let siblingsWidth = 0;
    Array.from(footer.children).forEach(ch => {
      if (ch === addr) return;
      siblingsWidth += ch.offsetWidth;
    });

    const paddingAllowance = 12;
    const availableWidth = Math.max(
      50,
      footer.clientWidth - siblingsWidth - paddingAllowance
    );

    // Reduce font size until address fits in one line or reaches minFont
    while (addr.scrollWidth > availableWidth && fontSize > minFont) {
      fontSize--;
      addr.style.fontSize = fontSize + "px";
    }

    // Safety: add ellipsis if text still slightly exceeds (edge case)
    if (addr.scrollWidth > availableWidth) {
      addr.style.textOverflow = "ellipsis";
    } else {
      addr.style.textOverflow = "clip";
    }
  });
}



// run once at load and on resize (you already called these elsewhere â€” keep them)
window.addEventListener("load", () => {
  adjustFooterFontSize();
  // small timeout to allow images/fonts/backgrounds to settle
  setTimeout(adjustFooterFontSize, 200);
});
window.addEventListener("resize", () => {
  adjustFooterFontSize();
});

function adjustFooterPosition() {
  const footers = document.querySelectorAll("#storeFooterName");
  footers.forEach(footer => {
    const textLength = footer.textContent.trim().length;
    // moved values slightly down compared to earlier defaults
    footer.style.bottom = textLength > 128 ? "26px" : "34px";
  });
}
// ---------------- Template Upload ----------------
document.getElementById("templateUpload").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    const slide = document.createElement("div");
    slide.className = "slide";
    slide.innerHTML = `<img src="${ev.target.result}" alt="Custom Template"><div class="name">Custom Template</div>`;
    slide.addEventListener("click", () => {
      templateBox.style.width = "794px";
      templateBox.style.height = "1123px";
      templateBox.style.margin = "0 auto";
      templateBox.style.display = "block";
      templateBox.style.backgroundImage = `url(${ev.target.result})`;
      templateBox.style.backgroundSize = "cover";
      templateBox.style.backgroundPosition = "center";
      templateBox.style.backgroundRepeat = "no-repeat";
      Array.from(templateBox.children).forEach(child => {
        if(child.id !== "storeFooter" && child.id !== "storeFooterName") child.remove();
      });
      if(!document.getElementById("storeFooterName")) {
        const nameEl = document.createElement("p");
        nameEl.id = "storeFooterName";
        nameEl.textContent = "Default Store Name";
        templateBox.appendChild(nameEl);
      }
    });
    templateSlider.appendChild(slide);

    const allBoxes = document.querySelectorAll(".template-box");
    allBoxes.forEach(box => {
      box.style.width = "794px";
      box.style.height = "1123px";
      box.style.margin = "0 auto";
      box.style.display = "block";
      box.style.backgroundImage = `url(${ev.target.result})`;
      box.style.backgroundSize = "cover";
      box.style.backgroundPosition = "center";
      box.style.backgroundRepeat = "no-repeat";
      Array.from(box.children).forEach(child => {
        if(child.id !== "storeFooter" && child.id !== "storeFooterName") child.remove();
      });
      if(!box.querySelector("#storeFooterName")) {
        const nameEl = document.createElement("p");
        nameEl.id = "storeFooterName";
        nameEl.textContent = "Default Store Name";
        box.appendChild(nameEl);
      }
    });
  };
  reader.readAsDataURL(file);
});

// ---------------- Preloaded Templates ----------------
const preloadedTemplates = ["template1.jpg","template2.jpg"];
preloadedTemplates.forEach(src => {
  const slide = document.createElement("img");
  slide.src = src;
  templateSlider.appendChild(slide);
  slide.addEventListener("click", () => {
    const boxes = document.querySelectorAll(".template-box");
    boxes.forEach(box => {
      box.style.width = "794px";
      box.style.height = "1123px";
      box.style.margin = "0 auto";
      box.style.display = "block";
      box.style.backgroundImage = `url(${src})`;
      box.style.backgroundSize = "cover";
      box.style.backgroundPosition = "center";
      box.style.backgroundRepeat = "no-repeat";
      Array.from(box.children).forEach(child => {
        if(child.id !== "storeFooter" && child.id !== "storeFooterName") child.remove();
      });
    });
  });
});



// // ---------------- Clone Templates from EXCEL (State-wise templates) ----------------
// document.getElementById("storesExcel")?.addEventListener("change", async function (e) {
//   const file = e.target.files[0];
//   if (!file) return alert("Please upload an Excel file!");

//   try {
//     const buffer = await file.arrayBuffer();
//     const workbook = XLSX.read(buffer, { type: "array" });
//     const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
//     const rows = XLSX.utils.sheet_to_json(firstSheet, { defval: "" });
//     if (!rows.length) return alert("No data found in Excel!");

//     const container = document.getElementById("templatesContainer");
//     const original = document.getElementById("templateBox");
//     if (!original || !container) return alert("Template or container not found!");

//     container.innerHTML = ""; // clear previous

//     // Identify keys
//     const keys = Object.keys(rows[0]).map(k => k.toLowerCase());
//     const addressKey = keys.find(k => k.includes("address")) || "address";
//     const mobileKey  = keys.find(k => k.includes("mobile")) || keys.find(k => k.includes("phone")) || "mobile";
//     const stateKey   = keys.find(k => k.includes("state"))  || "state";

//     // Group by state
//     const grouped = {};
//     rows.forEach(row => {
//       const state = row[stateKey] || "Unknown";
//       if (!grouped[state]) grouped[state] = [];
//       grouped[state].push(row);
//     });

//     // Create templates for each state
//     Object.entries(grouped).forEach(([state, stores]) => {
//       const stateHeader = document.createElement("h3");
//       stateHeader.textContent = state.toUpperCase();
//       stateHeader.style.marginTop = "30px";
//       container.appendChild(stateHeader);

//       const stateWrapper = document.createElement("div");
//       stateWrapper.style.display = "flex";
//       stateWrapper.style.flexWrap = "wrap";
//       stateWrapper.style.gap = "10px";
//       container.appendChild(stateWrapper);

//       stores.forEach(store => {
//         const clone = original.cloneNode(true);
//         const footerEl = clone.querySelector("#storeFooterName");
//         if (!footerEl) return;

//         const storeAddress = store[addressKey] || "";
//         const storeMobile  = store[mobileKey]  || "";

//         footerEl.innerHTML = `
//           <span class="store-address">${storeAddress}</span>
//           ${storeMobile
//             ? `<span class="separator">|</span>
//                <span class="contact-logo">
//                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20">
//                    <circle class="contact-circle" cx="12" cy="12" r="12" fill="#9A6C0C"></circle>
//                    <path class="contact-icon" d="M6.62 10.79a15.053 15.053 0 006.59 6.59l2.2-2.2a1 1 0 011.11-.21c1.21.48 2.53.73 3.88.73a1 1 0 011 1v3.5a1 1 0 01-1 1C10.07 21 3 13.93 3 5a1 1 0 011-1h3.5a1 1 0 011 1c0 1.35.25 2.67.73 3.88.12.28.07.61-.21 1.11l-2.2 2.2z" fill="#ffffff"/>
//                  </svg>
//                </span>
//                <span class="store-mobile">${storeMobile}</span>`
//             : ""}
//         `;

//         footerEl.style.display = "flex";
//         footerEl.style.alignItems = "center";
//         footerEl.style.gap = "4px";
//         footerEl.style.whiteSpace = "nowrap";

//         stateWrapper.appendChild(clone);
//       });
//     });

//     // Apply your functions
//     if (typeof applyColors === "function") applyColors();
//     adjustFooterFontSize();
//     adjustFooterPosition();

//     alert("âœ… Templates created successfully, grouped by state!");
//   } catch (err) {
//     console.error(err);
//     alert("âŒ Error reading Excel file. Make sure it's a valid .xlsx or .csv file.");
//   }
// });


// ---------------- Clone Templates from EXCEL (State filter + footer only) ----------------
let excelData = [];
let groupedData = {};

document.getElementById("storesExcel")?.addEventListener("change", async function (e) {
  const file = e.target.files[0];
  if (!file) return alert("Please upload an Excel file!");

  try {
    const buffer = await file.arrayBuffer();
    const workbook = XLSX.read(buffer, { type: "array" });
    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(firstSheet, { defval: "" });
    if (!rows.length) return alert("No data found in Excel!");

    excelData = rows;
    const keys = Object.keys(rows[0]).map(k => k.toLowerCase());
    const stateKey = keys.find(k => k.includes("state")) || "state";

    // Extract unique states for dropdown
    const states = [...new Set(rows.map(r => r[stateKey] || "Unknown"))].sort();

    const stateSelect = document.getElementById("stateFilter");
    stateSelect.innerHTML = `<option value="">-- All States --</option>`;
    states.forEach(s => {
      const opt = document.createElement("option");
      opt.value = s;
      opt.textContent = s;
      stateSelect.appendChild(opt);
    });

    alert("âœ… Excel loaded successfully! Now select a state to generate templates.");
  } catch (err) {
    console.error(err);
    alert("âŒ Error reading Excel file. Ensure it's a valid .xlsx or .csv file.");
  }
});

document.getElementById("generateStateTemplates")?.addEventListener("click", function () {
  if (!excelData.length) return alert("Please upload Excel file first!");

  const stateSelect = document.getElementById("stateFilter");
  const selectedState = stateSelect.value;
  const container = document.getElementById("templatesContainer");
  const original = document.getElementById("templateBox");
  if (!original || !container) return alert("Template box or container missing!");
  container.innerHTML = "";

  const keys = Object.keys(excelData[0]).map(k => k.toLowerCase());
  const stateKey = keys.find(k => k.includes("state")) || "state";
  const addressKey = keys.find(k => k.includes("address")) || keys.find(k => k.includes("store"));
  const mobileKey = keys.find(k => k.includes("mobile")) || keys.find(k => k.includes("phone")) || "mobile";

  let filtered = excelData;
  if (selectedState) filtered = excelData.filter(r => (r[stateKey] || "").toLowerCase() === selectedState.toLowerCase());

  if (!filtered.length) return alert("No records found for selected state!");

  const stateHeader = document.createElement("h3");
  stateHeader.textContent = selectedState || "All States";
  stateHeader.style.marginTop = "30px";
  container.appendChild(stateHeader);

  const wrapper = document.createElement("div");
  wrapper.style.display = "flex";
  wrapper.style.flexWrap = "wrap";
  wrapper.style.gap = "10px";
  container.appendChild(wrapper);

  filtered.forEach(store => {
    const clone = original.cloneNode(true);
    const footerEl = clone.querySelector("#storeFooterName");
    if (!footerEl) return;

    const storeAddress = store[addressKey] || "";
    const storeMobile = store[mobileKey] || "";

    footerEl.innerHTML = `
      <span class="store-address">${storeAddress}</span>
      ${storeMobile
        ? `<span class="separator">|</span>
           <span class="contact-logo">
             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20">
               <circle class="contact-circle" cx="12" cy="12" r="12" fill="#9A6C0C"></circle>
               <path class="contact-icon" d="M6.62 10.79a15.053 15.053 0 006.59 6.59l2.2-2.2a1 1 0 011.11-.21c1.21.48 2.53.73 3.88.73a1 1 0 011 1v3.5a1 1 0 01-1 1C10.07 21 3 13.93 3 5a1 1 0 011-1h3.5a1 1 0 011 1c0 1.35.25 2.67.73 3.88.12.28.07.61-.21 1.11l-2.2 2.2z" fill="#ffffff"/>
             </svg>
           </span>
           <span class="store-mobile">${storeMobile}</span>`
        : ""}
    `;

    footerEl.style.display = "flex";
    footerEl.style.alignItems = "center";
    footerEl.style.gap = "4px";
    footerEl.style.whiteSpace = "nowrap";

    wrapper.appendChild(clone);
  });

  if (typeof applyColors === "function") applyColors();
  adjustFooterFontSize();
  adjustFooterPosition();

  alert(`âœ… ${filtered.length} templates generated for ${selectedState || "all states"}!`);
});

// ---------------- Download Each Template as A4 PDF ----------------
async function downloadEachTemplateA4() {
  const templates = document.querySelectorAll(".template-box");
  if(!templates.length) { alert("No templates found!"); return; }

  for(let i=0; i<templates.length; i++) {
    const canvas = await html2canvas(templates[i], { scale: 2 });
    const imgData = canvas.toDataURL("image/png");
    const pdf = new jspdf.jsPDF("p","mm","a4");
    const pdfWidth = 210, pdfHeight = 297;
    const imgWidth = pdfWidth;
    const imgHeight = (canvas.height * pdfWidth) / canvas.width;
    const yOffset = imgHeight < pdfHeight ? (pdfHeight - imgHeight)/2 : 0;
    pdf.addImage(imgData,"PNG",0,yOffset,imgWidth,imgHeight);
    pdf.save(`template_${i+1}.pdf`);
    await new Promise(r => setTimeout(r,400));
  }
  alert("âœ… All templates downloaded successfully!");
}
</script>
</body>
</html>
